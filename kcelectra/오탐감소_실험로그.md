## KcELECTRA 오탐(FP) 감소 실험 로그 / 할 일

### 목표
- **오탐(FP: 정상→악성)**을 줄인다.
- 단순 F1 최적화가 아니라, 운영 관점에서 **Precision(정밀도) / FPR(정상 중 악성으로 찍힌 비율)**을 함께 관리한다.

---

### 현재 노트북(`kcelectra/KcElectra_학습.ipynb`) 기반 변경 후보
- **임계값(threshold) 튜닝**
  - validation logits로 threshold(0~1) 스윕
  - 지표: FP, FPR, Precision, Recall, F1
  - 운영안: 회색지대(예: 0.4~0.7) 보류/재검토 옵션
- **베스트 모델 선택 기준 변경**
  - `metric_for_best_model`: `f1` → `precision`
  - (필요 시) `greater_is_better=True`
- **Loss 비용 비대칭화(오탐 벌점 강화)**
  - `CrossEntropyLoss(weight=...)`에서 **정상(0) 가중치↑**(예: w0>w1)
  - 목적: 정상 샘플을 악성으로 보내는 실수를 더 크게 벌줌
- **하드 네거티브(정상인데 욕/은어/밈 포함) 데이터 보강**
  - FP 사례를 모아 정상 라벨로 재학습에 포함
- **확률 보정(캘리브레이션)**
  - Temperature scaling 등으로 과신 완화 → threshold 재튜닝

---

### 실험 체크리스트(권장 순서)
- [ ] (E1) **Threshold 튜닝만 적용** (모델 가중치 동일, threshold만 변경)
- [ ] (E2) **베스트 모델 기준 precision으로 변경** 후 재학습
- [ ] (E3) **Loss 가중치(정상 0 가중↑)** 적용 후 재학습
- [ ] (E4) (선택) 하드 네거티브 보강 후 재학습
- [ ] (E5) (선택) 캘리브레이션 + threshold 재튜닝

---

### 결과 기록 템플릿(복사해서 누적)
#### 실험 ID: E?
- 변경 사항:
  - (예) threshold 0.5→0.72
  - (예) best metric f1→precision
  - (예) class weight [w0, w1]=[?, ?]
- 데이터:
  - train/validation split: (random_state=42, stratify=label)
  - max_length=128, batch_size=?, epochs=?
- Validation 성능(핵심):
  - FP(정상→악성): 
  - FPR:
  - Precision:
  - Recall:
  - F1:
  - AUC(참고):
- 코멘트:
  - 오탐이 주로 발생한 문장 유형:
  - 운영 threshold/보류 구간 제안:

---

#### 실험 ID: E-draft-LOL (아직 미실행)
- 변경 사항:
  - 학습 데이터에 `datasets/LOL_badwords_all_merged.csv` 추가
  - 적용 파일: `kcelectra/KcElectra_ver2_csv.ipynb`
  - 데이터 로딩 셀에서 `df = concat([abusive, nonabusive, lol])`
  - 기타 하이퍼파라미터/metric/Loss 가중치는 기존 그대로 (metric=f1, class_weights=[1,1])
- 데이터:
  - 경로: `DATA_DIR = "datasets"` (노트북 기본 설정)
  - 사용 파일: `combined_abusive_shuffled_20k.csv`, `nonabusive_merged_shuffled_sample20000.csv`, `LOL_badwords_all_merged.csv`
  - split: train/test = 0.8/0.2, stratify=label (기존 그대로)
- Validation/테스트 성능: 미실행 (추후 기입)
- 코멘트:
  - 목표: 욕설 다양성 확장으로 FP/특히 변형 욕 탐지 강화 기대
  - 실행 후 threshold 튜닝/precision 기준 비교 필요

#### 실험 ID: E-draft-threshold (아직 미실행)
- 변경 사항:
  - `kcelectra/KcElectra_ver1_threshold.ipynb`에서 데이터 경로를 `DATA_DIR="datasets"`로 통일 (기존 외부 절대경로 제거)
  - 이 버전에는 아직 threshold 스윕/precision 기준/가중치 조정이 적용되지 않음 (기본 metric=f1, class_weights=[1,1], predict threshold=0.5 유지)
- 데이터:
  - 경로: `datasets`
  - 사용 파일: `combined_abusive_shuffled_20k.csv`, `nonabusive_merged_shuffled_sample20000.csv` (2개)
  - split: train/test = 0.8/0.2, stratify=label (기존 그대로)
- Validation/테스트 성능: 미실행 (추후 기입)
- 코멘트:
  - threshold 튜닝/precision 기준/가중치 조정이 필요한 상태
  - 실행 후 FP/FPR 개선 여부를 기존 `KcElectra_학습.ipynb` 기준과 비교 예정
